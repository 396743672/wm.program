<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="org.github.ycg000344.weiming.application.basicmanager.mapper.BaseUserInfoMapper">
	<resultMap id="BaseResultMap"
		type="org.github.ycg000344.weiming.application.basicmanager.entity.BaseUserInfo">
		<!-- WARNING - @mbg.generated -->
		<id column="user_id" property="userId" jdbcType="INTEGER" />
		<result column="login_name" property="loginName"
			jdbcType="VARCHAR" />
		<result column="user_name" property="userName"
			jdbcType="VARCHAR" />
		<result column="create_time" property="createTime"
			jdbcType="TIMESTAMP" />
		<result column="update_time" property="updateTime"
			jdbcType="TIMESTAMP" />
		<result column="status" property="status" jdbcType="INTEGER" />
	</resultMap>

	<!-- -->
	<resultMap id="UserInfoVO"
		type="org.github.ycg000344.weiming.application.basicmanager.vo.UserInfoVO">
		<result column="role_ids" property="role_ids"
			jdbcType="VARCHAR" />
		<result column="roles" property="roles" jdbcType="VARCHAR" />
		<result column="router_ids" property="router_ids"
			jdbcType="VARCHAR" />
		<association property="baseUserInfo"
			resultMap="BaseResultMap"></association>
	</resultMap>

	<select id="selectByUserId" resultType="String"
		resultMap="UserInfoVO">
		SELECT
			v1.user_id,
			v1.login_name,
			v1.user_name,
			v1.create_time,
			v1.update_time,
			v1.status,
			v1.router_ids ,
			v1.role_ids,
			( SELECT GROUP_CONCAT( t1.role_name )
			FROM t_base_role t1
			WHERE EXISTS ( SELECT v2.role_ids FROM v_user_roles_routers v2 WHERE v2.user_id = #{userId} )
			) AS roles
		FROM
			v_user_roles_routers v1
		WHERE
			v1.user_id = #{userId}
	</select>
</mapper>
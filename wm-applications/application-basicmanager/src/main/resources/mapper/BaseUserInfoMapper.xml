<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="org.github.ycg000344.weiming.application.basicmanager.mapper.BaseUserInfoMapper">
	<resultMap id="BaseResultMap"
		type="org.github.ycg000344.weiming.application.basicmanager.entity.BaseUserInfo">
		<!-- WARNING - @mbg.generated -->
		<id column="user_id" property="userId" jdbcType="INTEGER" />
		<result column="login_name" property="loginName"
			jdbcType="VARCHAR" />
		<result column="user_name" property="userName"
			jdbcType="VARCHAR" />
		<result column="create_time" property="createTime"
			jdbcType="TIMESTAMP" />
		<result column="update_time" property="updateTime"
			jdbcType="TIMESTAMP" />
		<result column="status" property="status" jdbcType="INTEGER" />
	</resultMap>

	<!-- -->
	<resultMap id="UserInfoVO"
		type="org.github.ycg000344.weiming.application.basicmanager.vo.UserInfoVO">
		<result column="role_ids" property="role_ids"
			jdbcType="VARCHAR" />
		<result column="roles" property="roles" jdbcType="VARCHAR" />
		<result column="router_ids" property="router_ids"
			jdbcType="VARCHAR" />
		<association property="baseUserInfo"
			resultMap="BaseResultMap"></association>
	</resultMap>

	<select id="selectByUserId" resultType="String"
		resultMap="UserInfoVO">
		SELECT
		t1.user_id,
		t1.login_name,
		t1.user_name,
		t1.create_time,
		t1.update_time,
		t1.status,
		IFNULL( t2.role_ids, '' ) as role_ids,
		IFNULL( t3.router_ids, '' ) as router_ids,
		( SELECT GROUP_CONCAT( t4.role_name )
		FROM t_base_role t4
		WHERE EXISTS ( SELECT t5.role_ids FROM t_base_user_roles t5 WHERE t5.user_id = #{userId} ) ) AS roles
		FROM
		t_base_user t1
		LEFT JOIN t_base_user_roles t2 ON t1.user_id = t2.user_id AND t2.status = 1
		LEFT JOIN t_base_user_routers t3 ON t1.user_id = t3.user_id AND t3.status = 1
		WHERE
		t1.user_id = #{userId}
	</select>
</mapper>